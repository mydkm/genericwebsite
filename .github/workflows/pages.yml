name: Deploy Pages

  on:
    push:
      branches: [main]
    workflow_dispatch:

  permissions:
    contents: read
    pages: write
    id-token: write

  concurrency:
    group: pages
    cancel-in-progress: true

  jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4

        # Optional (only if you run bun-based build steps)
        - uses: oven-sh/setup-bun@v2
          with:
            bun-version: latest

        - uses: typst-community/setup-typst@v4

        - name: Build CV PDF
          run: |
            mkdir -p generated/cv
            typst compile --root . "CV - Joshua Davidov.typ" generated/cv/Joshua-Davidov-
  CV.pdf

        - name: Prepare static site
          run: |
            mkdir -p dist
            cp -r index.html main blog generated dist/
            [ -f .nojekyll ] && cp .nojekyll dist/ || true
            [ -f CNAME ] && cp CNAME dist/ || true

        - uses: actions/upload-pages-artifact@v4
          with:
            path: dist

    deploy:
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
      runs-on: ubuntu-latest
      needs: build
      steps:
        - id: deployment
          uses: actions/deploy-pages@v4
